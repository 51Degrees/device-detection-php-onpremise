<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees Device Detection On-Premise PHP: onpremise/matchMetrics.php</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="../../documentation/4.4/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees Device Detection On-Premise PHP
   &#160;<span id="projectnumber">4.4</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">Device detection services for 51Degrees Pipeline</div>
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('onpremise_2match_metrics_8php-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="g-docs__header">
<h2 class="g-docs__page-title">onpremise/matchMetrics.php</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>The example illustrates the various metrics that can be obtained about the device detection process, for example, the degree of certainty about the result. Running the example outputs those properties and values..</p>
<p>There is a (discussion)[<a href="https://51degrees.com/documentation/_device_detection__hash.html#DeviceDetection_Hash_DataSetProduction_Performance">https://51degrees.com/documentation/_device_detection__hash.html#DeviceDetection_Hash_DataSetProduction_Performance</a>] of metrics and controlling performance on our web site. See also the (performance options) [<a href="https://51degrees.com/documentation/_device_detection__features__performance_options.html">https://51degrees.com/documentation/_device_detection__features__performance_options.html</a>] page. </p><h1 class="g-docs__section-heading">Location</h1>
<p>This example is available in full on <a href="https://github.com/51Degrees/device-detection-php-onpremise/blob/master/examples/onpremise/matchMetrics.php">GitHub</a>.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">&lt;?php</div><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2023 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line">require_once(__DIR__ . <span class="c-code__stringliteral">&quot;/exampleUtils.php&quot;</span>);</div><div class="c-code__line">require_once(__DIR__ . <span class="c-code__stringliteral">&quot;/../../vendor/autoload.php&quot;</span>);</div><div class="c-code__line"></div><div class="c-code__line">use <a name="_a0"></a><a class="code" href="classfiftyone_1_1pipeline_1_1devicedetection_1_1_device_detection_on_premise.html">fiftyone\pipeline\devicedetection\DeviceDetectionOnPremise</a>;</div><div class="c-code__line">use <a name="_a1"></a><a class="code" href="classfiftyone_1_1pipeline_1_1core_1_1_pipeline_builder.html">fiftyone\pipeline\core\PipelineBuilder</a>;</div><div class="c-code__line">use <a name="_a2"></a><a class="code" href="classfiftyone_1_1pipeline_1_1core_1_1_logger.html">fiftyone\pipeline\core\Logger</a>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">class </span><a name="_a3"></a><a class="code" href="class_match_metrics.html">MatchMetrics</a></div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">public</span> <span class="c-code__keyword">function</span> <a name="a4"></a><a class="code" href="class_match_metrics.html#a83f395bdf9d89f09fa6006f7bfa33e96">run</a>($showDescs, $logger, callable $output)</div><div class="c-code__line">    {</div><div class="c-code__line">        $engine = <span class="c-code__keyword">new</span> DeviceDetectionOnPremise(array(</div><div class="c-code__line">            <span class="c-code__comment">// You can improve matching performance by specifying only those</span></div><div class="c-code__line">            <span class="c-code__comment">// properties you wish to use. If you don&#39;t specify any properties</span></div><div class="c-code__line">            <span class="c-code__comment">// you will get all those available in the data file tier that</span></div><div class="c-code__line">            <span class="c-code__comment">// you have used. The free &quot;Lite&quot; tier contains fewer than 20.</span></div><div class="c-code__line">            <span class="c-code__comment">// Since we are specifying properties here, we will only see</span></div><div class="c-code__line">            <span class="c-code__comment">// those properties, along with the match metric properties</span></div><div class="c-code__line">            <span class="c-code__comment">// in the output.</span></div><div class="c-code__line">            <span class="c-code__comment">// Set the values required in the php.ini file using the</span></div><div class="c-code__line">            <span class="c-code__comment">// FiftyOneDegreesHashEngine.required_properties option.</span></div><div class="c-code__line">            <span class="c-code__comment">// If using the full on-premise data file more properties will be</span></div><div class="c-code__line">            <span class="c-code__comment">// present in the data file. See https://51degrees.com/pricing</span></div><div class="c-code__line">        ));</div><div class="c-code__line">        $pipeline = (<span class="c-code__keyword">new</span> PipelineBuilder())</div><div class="c-code__line">            -&gt;add($engine)</div><div class="c-code__line">            -&gt;addLogger($logger)</div><div class="c-code__line">            -&gt;build();</div><div class="c-code__line"></div><div class="c-code__line">        <a name="a5"></a><a class="code" href="class_example_utils.html#aef48b5620dbf425a09e85b3913c9e409">ExampleUtils::checkDataFile</a>($pipeline-&gt;getElement(<span class="c-code__stringliteral">&quot;device&quot;</span>), $logger);</div><div class="c-code__line">    </div><div class="c-code__line">        <span class="c-code__comment">// FlowData is a data structure that is used to convey</span></div><div class="c-code__line">        <span class="c-code__comment">// information required for detection and the results of the</span></div><div class="c-code__line">        <span class="c-code__comment">// detection through the pipeline.</span></div><div class="c-code__line">        <span class="c-code__comment">// Information required for detection is called &quot;evidence&quot;</span></div><div class="c-code__line">        <span class="c-code__comment">// and usually consists of a number of HTTP Header field</span></div><div class="c-code__line">        <span class="c-code__comment">// values, in this case represented by a dictionary of header</span></div><div class="c-code__line">        <span class="c-code__comment">// name/value entries.</span></div><div class="c-code__line">        $data = $pipeline-&gt;createFlowData();</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// Process a single evidence to retrieve the values</span></div><div class="c-code__line">        <span class="c-code__comment">// associated with the user-agent and other evidence such as sec-ch-* for the</span></div><div class="c-code__line">        <span class="c-code__comment">// selected properties.</span></div><div class="c-code__line">        $data-&gt;evidence-&gt;setArray($this-&gt;evidenceValues);</div><div class="c-code__line">        $data-&gt;process();</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// Now that it&#39;s been processed, the flow data will have</span></div><div class="c-code__line">        <span class="c-code__comment">// been populated with the result. In this case, we want</span></div><div class="c-code__line">        <span class="c-code__comment">// information about the device, which we can get by</span></div><div class="c-code__line">        <span class="c-code__comment">// asking for a result matching named &quot;device&quot;</span></div><div class="c-code__line">        $device = $data-&gt;device;</div><div class="c-code__line"></div><div class="c-code__line">        $output(<span class="c-code__stringliteral">&quot;--- Compare evidence with what was matched ---&quot;</span>);</div><div class="c-code__line">        $output(<span class="c-code__stringliteral">&quot;&quot;</span>);</div><div class="c-code__line">        $output(<span class="c-code__stringliteral">&quot;Evidence&quot;</span>);</div><div class="c-code__line">        <span class="c-code__comment">// output the evidence in reverse value length order</span></div><div class="c-code__line">        uasort($this-&gt;evidenceValues, <span class="c-code__keyword">function</span>($a, $b) {</div><div class="c-code__line">            <span class="c-code__keywordflow">return</span> strlen($b) - strlen($a);</div><div class="c-code__line">        });</div><div class="c-code__line">        <span class="c-code__keywordflow">foreach</span> ($this-&gt;evidenceValues as $key =&gt; $value)</div><div class="c-code__line">        {</div><div class="c-code__line">            $output(<span class="c-code__stringliteral">&quot;    $key: $value&quot;</span>);</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// Obtain the matched User-Agents: the matched substrings in the</span></div><div class="c-code__line">        <span class="c-code__comment">// User-Agents are separated with underscores - output in forward length order.</span></div><div class="c-code__line">        $output(<span class="c-code__stringliteral">&quot;Matches&quot;</span>);</div><div class="c-code__line">        $useragents = $device-&gt;useragents-&gt;value;</div><div class="c-code__line">        usort($useragents, <span class="c-code__keyword">function</span>($a, $b) {</div><div class="c-code__line">            <span class="c-code__keywordflow">return</span> strlen($a) - strlen($b);</div><div class="c-code__line">        });</div><div class="c-code__line">        <span class="c-code__keywordflow">foreach</span>($useragents as $useragent)</div><div class="c-code__line">        {</div><div class="c-code__line">            $output(<span class="c-code__stringliteral">&quot;    Matched User-Agent: $useragent&quot;</span>);</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        $output(<span class="c-code__stringliteral">&quot;&quot;</span>);</div><div class="c-code__line"></div><div class="c-code__line">        $output(<span class="c-code__stringliteral">&quot;--- Listing all available properties, by component, by property &quot;</span> .</div><div class="c-code__line">            <span class="c-code__stringliteral">&quot;name ---&quot;</span>);</div><div class="c-code__line">        $output(<span class="c-code__stringliteral">&quot;For a discussion of what the match properties mean, see: &quot;</span> .</div><div class="c-code__line">            <span class="c-code__stringliteral">&quot;https://51degrees.com/documentation/_device_detection__hash&quot;</span> .</div><div class="c-code__line">            <span class="c-code__stringliteral">&quot;.html#DeviceDetection_Hash_DataSetProduction_Performance&quot;</span>);</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// retrieve the available properties from the hash engine. The properties</span></div><div class="c-code__line">        <span class="c-code__comment">// available depends on</span></div><div class="c-code__line">        <span class="c-code__comment">// a) the use of FiftyOneDegreesHashEngine.required_properties option in the</span></div><div class="c-code__line">        <span class="c-code__comment">// php.ini file.</span></div><div class="c-code__line">        <span class="c-code__comment">// which controls which properties will be extracted, and also affects</span></div><div class="c-code__line">        <span class="c-code__comment">// the performance of extraction</span></div><div class="c-code__line">        <span class="c-code__comment">// b) the tier of data file being used. The Lite data file contains fewer</span></div><div class="c-code__line">        <span class="c-code__comment">// than 20 of the &gt;200 available properties</span></div><div class="c-code__line">        $availableProperties =</div><div class="c-code__line">            $pipeline-&gt;getElement(<span class="c-code__stringliteral">&quot;device&quot;</span>)-&gt;getProperties();</div><div class="c-code__line"></div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// create a Map keyed on the component name of the properties available</span></div><div class="c-code__line">        <span class="c-code__comment">// components being hardware, browser, OS and Crawler.</span></div><div class="c-code__line">        $categoryMap = array();</div><div class="c-code__line">        <span class="c-code__keywordflow">foreach</span> ($availableProperties as $property)</div><div class="c-code__line">        {</div><div class="c-code__line">            $component = $property[<span class="c-code__stringliteral">&quot;component&quot;</span>];</div><div class="c-code__line">            <span class="c-code__keywordflow">if</span> (array_key_exists($component, $categoryMap) === <span class="c-code__keyword">false</span>)</div><div class="c-code__line">            {</div><div class="c-code__line">                $categoryMap[$component] = array();</div><div class="c-code__line">            }</div><div class="c-code__line">            $categoryMap[$component][] = $property;</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// iterate the map created above</span></div><div class="c-code__line">        <span class="c-code__keywordflow">foreach</span> ($categoryMap as $component =&gt; $componentProperties)</div><div class="c-code__line">        {</div><div class="c-code__line">            $output($component);</div><div class="c-code__line">            <span class="c-code__keywordflow">foreach</span> ($componentProperties as $property)</div><div class="c-code__line">            {</div><div class="c-code__line">                $name = $property[<span class="c-code__stringliteral">&quot;name&quot;</span>];</div><div class="c-code__line">                $description = $property[<span class="c-code__stringliteral">&quot;description&quot;</span>];</div><div class="c-code__line"></div><div class="c-code__line">                <span class="c-code__comment">// while we get the available properties and their metadata from the</span></div><div class="c-code__line">                <span class="c-code__comment">// pipeline we get the values for the last detection from flowData</span></div><div class="c-code__line">                $value = $device-&gt;$name;</div><div class="c-code__line"></div><div class="c-code__line">                <span class="c-code__comment">// output property names, values and descriptions</span></div><div class="c-code__line">                <span class="c-code__comment">// some property values are lists. $property[&quot;isList&quot;] will be true</span></div><div class="c-code__line">                <span class="c-code__keywordflow">if</span> ($value-&gt;hasValue &amp;&amp; is_array($value-&gt;value)) {</div><div class="c-code__line">                    $output(<span class="c-code__stringliteral">&quot;    $name: &quot;</span>.count($value-&gt;value).<span class="c-code__stringliteral">&quot; Values&quot;</span>);</div><div class="c-code__line">                    <span class="c-code__keywordflow">foreach</span> ($value-&gt;value as $x)</div><div class="c-code__line">                    {</div><div class="c-code__line">                        $output(<span class="c-code__stringliteral">&quot;        : $x&quot;</span>);</div><div class="c-code__line">                    }</div><div class="c-code__line">                }</div><div class="c-code__line">                <span class="c-code__keywordflow">else</span></div><div class="c-code__line">                {</div><div class="c-code__line">                    $output(<span class="c-code__stringliteral">&quot;    $name: $value-&gt;value&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">                <span class="c-code__keywordflow">if</span> ($showDescs === <span class="c-code__keyword">true</span>) {</div><div class="c-code__line">                    $output(<span class="c-code__stringliteral">&quot;        $description&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Evidence values from a windows 11 device using a browser</span></div><div class="c-code__line">    <span class="c-code__comment">// that supports User-Agent Client Hints.</span></div><div class="c-code__line">    <span class="c-code__keyword">private</span> $evidenceValues = array(</div><div class="c-code__line">        <span class="c-code__stringliteral">&quot;header.user-agent&quot;</span> =&gt;</div><div class="c-code__line">            <span class="c-code__stringliteral">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) &quot;</span>.</div><div class="c-code__line">            <span class="c-code__stringliteral">&quot;AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span>.</div><div class="c-code__line">            <span class="c-code__stringliteral">&quot;Chrome/98.0.4758.102 Safari/537.36&quot;</span>,</div><div class="c-code__line">        <span class="c-code__stringliteral">&quot;header.sec-ch-ua-mobile&quot;</span> =&gt; <span class="c-code__stringliteral">&quot;?0&quot;</span>,</div><div class="c-code__line">        <span class="c-code__stringliteral">&quot;header.sec-ch-ua&quot;</span> =&gt;</div><div class="c-code__line">            <span class="c-code__stringliteral">&quot;\&quot; Not A; Brand\&quot;;v=\&quot;99\&quot;, \&quot;Chromium\&quot;;v=\&quot;98\&quot;, &quot;</span>.</div><div class="c-code__line">            <span class="c-code__stringliteral">&quot;\&quot;Google Chrome\&quot;;v=\&quot;98\&quot;&quot;</span>,</div><div class="c-code__line">        <span class="c-code__stringliteral">&quot;header.sec-ch-ua-platform&quot;</span> =&gt; <span class="c-code__stringliteral">&quot;\&quot;Windows\&quot;&quot;</span>,</div><div class="c-code__line">        <span class="c-code__stringliteral">&quot;header.sec-ch-ua-platform-version&quot;</span> =&gt; <span class="c-code__stringliteral">&quot;\&quot;14.0.0\&quot;&quot;</span>);</div><div class="c-code__line">};</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// Only declare and call the main function if this is being run directly.</span></div><div class="c-code__line"><span class="c-code__comment">// This prevents main from being run where examples are run as part of</span></div><div class="c-code__line"><span class="c-code__comment">// PHPUnit tests.</span></div><div class="c-code__line"><span class="c-code__keywordflow">if</span> (basename(__FILE__) == basename($_SERVER[<span class="c-code__stringliteral">&quot;SCRIPT_FILENAME&quot;</span>]))</div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">function</span> main($argv)</div><div class="c-code__line">    {</div><div class="c-code__line">        <span class="c-code__comment">// Configure a logger to output to the console.</span></div><div class="c-code__line">        $logger = <span class="c-code__keyword">new</span> Logger(<span class="c-code__stringliteral">&quot;info&quot;</span>);</div><div class="c-code__line"></div><div class="c-code__line">        (<span class="c-code__keyword">new</span> <a class="code" href="class_match_metrics.html">MatchMetrics</a>())-&gt;run(<span class="c-code__keyword">false</span>, $logger, [<span class="c-code__stringliteral">&quot;ExampleUtils&quot;</span>, <span class="c-code__stringliteral">&quot;output&quot;</span>]);</div><div class="c-code__line">    }</div><div class="c-code__line"></div><div class="c-code__line">    main(isset($argv) ? array_slice($argv, 1) : <span class="c-code__keyword">null</span>);</div><div class="c-code__line">}</div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
