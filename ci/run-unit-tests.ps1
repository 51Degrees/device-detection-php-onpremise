param (
    [Parameter(Mandatory=$true)]
    [string]$RepoName
)

if (!(Test-Path assets/TAC-HashV41.hash)) {
    Write-Output "::warning file=$($MyInvocation.ScriptName),line=$($MyInvocation.ScriptLineNumber),title=No On-Premise Data File::On-Premise Data File wasn't found, so unit tests will not run."
    return
}

# Include php.ini with extension settings, generated by build-project
$sep = [IO.Path]::PathSeparator
$env:PHP_INI_SCAN_DIR = "$sep$PWD/$RepoName"

./php/run-unit-tests.ps1 -RepoName $RepoName

# Run configuration tests
& $RepoName/configuration-tests/testConcurrencySetting.ps1 -BaseIniFilePath $PWD/$RepoName/php.ini || $(throw "configuration tests failed")

exit $LASTEXITCODE
